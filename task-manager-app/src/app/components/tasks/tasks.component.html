<div class="container mt-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">Mis Tareas</h2>
      <p class="text-muted mb-0">
        {{ pendingTasks }} pendientes â€¢ {{ completedTasks }} completadas
      </p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="bi bi-plus-lg"></i> Nueva Tarea
    </button>
  </div>

  <!-- Loading -->
  @if (isLoading) {
    <div class="text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2 text-muted">Cargando tareas...</p>
    </div>
  }

  <!-- Error -->
  @if (errorMessage) {
    <div class="alert alert-danger" role="alert">
      {{ errorMessage }}
    </div>
  }

  <!-- Lista de Tareas -->
  @if (!isLoading && tasks.length > 0) {
    <div class="row">
      @for (task of tasks; track task.id) {
        <div class="col-md-6 col-lg-4 mb-3">
          <div class="card task-card" [class.completed]="task.isCompleted">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="task-title mb-0" [class.completed]="task.isCompleted">
                  {{ task.title }}
                </h5>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [checked]="task.isCompleted"
                    (change)="toggleTaskStatus(task)"
                    [id]="'task-' + task.id"
                  />
                </div>
              </div>

              @if (task.description) {
                <p class="task-description mb-2">{{ task.description }}</p>
              }

              <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="task-date">
                  {{ formatDate(task.createdAt) }}
                </small>
                <div>
                  @if (task.isCompleted) {
                    <span class="badge bg-success me-2">Completada</span>
                  } @else {
                    <span class="badge bg-warning text-dark me-2">Pendiente</span>
                  }
                </div>
              </div>

              <div class="mt-3 d-flex gap-2">
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="openEditModal(task)"
                >
                  Editar
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="openDeleteModal(task)"
                >
                  Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Estado VacÃ­o -->
  @if (!isLoading && tasks.length === 0) {
    <div class="empty-state">
      <div class="mb-3">ğŸ“</div>
      <h4>No tienes tareas</h4>
      <p>Crea tu primera tarea para comenzar a organizarte</p>
      <button class="btn btn-primary mt-3" (click)="openCreateModal()">
        Crear Primera Tarea
      </button>
    </div>
  }
</div>

<!-- Modal Crear/Editar Tarea -->
@if (showModal) {
  <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            {{ isEditing ? 'Editar Tarea' : 'Nueva Tarea' }}
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="saveTask()">
            <div class="mb-3">
              <label for="taskTitle" class="form-label">TÃ­tulo *</label>
              <input
                type="text"
                class="form-control"
                id="taskTitle"
                [(ngModel)]="taskTitle"
                name="taskTitle"
                placeholder="Ej: Completar proyecto"
                required
              />
            </div>

            <div class="mb-3">
              <label for="taskDescription" class="form-label">DescripciÃ³n</label>
              <textarea
                class="form-control"
                id="taskDescription"
                [(ngModel)]="taskDescription"
                name="taskDescription"
                rows="3"
                placeholder="Describe los detalles de tu tarea..."
              ></textarea>
            </div>

            <div class="d-flex gap-2 justify-content-end">
              <button type="button" class="btn btn-secondary" (click)="closeModal()">
                Cancelar
              </button>
              <button type="submit" class="btn btn-primary">
                {{ isEditing ? 'Guardar Cambios' : 'Crear Tarea' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
}

<!-- âœ… NUEVO - Modal Confirmar EliminaciÃ³n -->
@if (showDeleteModal) {
  <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">Confirmar EliminaciÃ³n</h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeDeleteModal()"></button>
        </div>
        <div class="modal-body">
          <p class="mb-2">Â¿EstÃ¡s seguro de que deseas eliminar la tarea?</p>
          <p class="fw-bold text-dark mb-2">"{{ taskToDelete?.title }}"</p>
          <p class="text-muted small mb-0">Esta acciÃ³n no se puede deshacer.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
            Cancelar
          </button>
          <button type="button" class="btn btn-danger" (click)="confirmDelete()">
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
}
